# emp-go-cron


## Назначение

Данный пакет предназначен для подключения фоновых процессов. Процессов м.б. столько, сколько нужно. Работать с ними можно по уникальным номерам.

Обратите внимание, что теперь параметр соедиения с БД перенесен в NewCron. 

## Пример

```go
// Шаг 1: описываем процесс, который надо запускать периодически
// Это д.б. функция, принимающая контекст и соединение с базой и возврающая ошибку (пока не обрататывается)
func foo(ctx context.Context, db *sql.DB) error {
	fmt.Printf("Call foo\n")
	var (
		s string
	)
	db.QueryRow("select description from category where id=4").Scan(&s)
	fmt.Printf("\t\t\tfoo=%s!\n", s)
	fmt.Printf("\t\t\tctx.testParam=%d!\n", ctx.Value("testParam"))
	fmt.Printf("\t\t\tctx.secondTestParam=%d!\n", ctx.Value("secondTestParam"))
	return nil
}

// Шаг 2: создадем крон-систему
cron := NewCron(db)
// Шаг 3: создаем расписание запуска процесса
// Данный код говорит, что надо запускаться каждые четные минуты
// Кроме того возможно использовать ключи: Hour, Day, Month
tm, _ := NewTimeMask(map[string][]int{"Min": []int{0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58}})

// Другой способ задать расписани. Синаксис,как в cron-file
tm, _ = NewTimeMaskFromString("*/3 9-18 5,20 *")

// Шаг 4: добавляем процесс, действующий по этому расписанию.
id, _ := c.AddTask(tm, foo)

// Шаг 5: добавляем параметры для процесса
c.AddParam(id, "testParam", 22)
c.AddParam(id, "secondTestParam", 222)

// Шаг 6: запускаем крон
c.StartCron()

// Прочие возможности.
// отключение процесса
c.DeActivateTask(id)
// повторное включение процесса 
c.ReActuveteTask(id)

// Шаг 7.1: завершение крона
c.Quit <- true

// Шаг 7.2: завершение крона
c.DownCron()

// Шаг 100: запуск по необходимости
c.Fire(id)

```

## ToDo

* [x] AddParam - не понятная история с присвоением контекста через id
* [x] Переделать на реальные ключи, т.е. с поиском
* [x] почему все параметы публичные?