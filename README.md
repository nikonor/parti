# Шаблон модуля платформы

Шаблон модуля - структурированный набор файлов и директорий, содержащий необходимый минимум,
готовые пакеты для типовых задач, и, по своей сути является фреймворком.

<!-- TOC -->

- [Шаблон модуля платформы](#шаблон-модуля-платформы)
    - [Цели](#цели)
    - [Быстрый старт](#быстрый-старт)
    - [Запуск модуля](#запуск-модуля)
    - [Вендоринг](#вендоринг)
    - [База данных](#база-данных)
    - [Пакеты в шаблоне модуля](#пакеты-в-шаблоне-модуля)
        - [Логер](#логер)
        - [Конфиг](#конфиг)
    - [Передача модуля в тестирование и эксплуатацию](#передача-модуля-в-тестирование-и-эксплуатацию)

<!-- /TOC -->

## Цели

- Упростить разработку новых модулей платформы.
- Облегчить процесс совместного владения и работы с кодом модулей.
- Унифицировать эксплуатацию и управление модулями.

## Быстрый старт

Скрипт автоматизиции создания нового модуля из шаблона:

```bash
./scripts/create.sh my-module
```

Скрипт объединяет шаги описанные в [инструкции](docs/dev/newmodule.md).

## Запуск модуля.

```bash
./run.sh
```

## Проверка работоспособности модуля

```bash
curl localhost:8087/m | jq
```

```json
{
  "pid": 29950,
  "cpu": 4,
  "host": "ThinkPad-X250",
  "name": "my-project",
  "version": "",
  "commit": "",
  "build_time": "2018-04-09T21:16:53",
  "go_template_version": "1.8",
  "instance_guid": "f2c5b1ad5eb8efeb86291723a7a7dfab",
  "cfg_md5_sum": "fd9915894f2fceeaf65194945881b482",
  "go_build_version": "",
  "go_version": "go version go1.8.7 linux/amd64",
  "go_build_template": "",
  "up_time": "1m10.191363339s"
}
```

## Вендоринг

[Подробности](docs/vendor.md) о работе с зависимостями и каталогом vendor

## Пакеты в шаблоне модуля

### Логер

Пакет **logger** - средство логирования, использует syslog.
Частью этого пакета является файл logger_list.go, который является справочником ошибок.
[Подробности](docs/logger.md) работы с логером (пока не готов)

### Конфиг

Пакет **config** - средство работы с конфигурацией, использует json_schema.
[Описание](docs/config.md) работы с конфигурацией

# Служебный API


| Метод  | URI              | Описание                    |
| ------ | ---------------- | --------------------------- |
| GET    | /m               | Cостояние модуля            |
| GET    | /m/config/schema | json-schema конфигурации    |
| GET    | /m/config/get    | Текущая конфигурация        |
| POST   | /m/config/set    | Запись конфигурации в бд    |
| POST   | /m/app/reload    | Перезагрузка модуля         |
| GET    | /m/doc/json      | Автоматическая документация |
| GET    | /m/doc/txt       | Автоматическая документация |
| GET    | /m/entily/list   | Список схем сущностей       |
| POST   | /m/entity/create | Создать экземпляр сущности  |
| GET    | /m/entity/get    | Получить экземпляр сущности |
| POST   | /m/entity/update | Обновить экземпляр сущности |
| POST   | /m/entity/delete | Удалить экземпляр сущности  |
| POST   | /m/entity/rpc    | Вызвать удаленную процедуру |


## Передача модуля в тестирование и эксплуатацию

[Порядок](docs/qa.md) действий при передаче модуля в тестирование и дальнейшую поддержку

## Внешние зависимости:

* github.com/labstack/echo
* github.com/lib/pq
* github.com/assembla/cony
* github.com/streadway/amqp
* gopkg.in/yaml.v2
* github.com/xeipuuv/gojsonschema
* gopkg.in/mgo.v2/bson
* gopkg.in/go-playground/validator.v9
* github.com/fredli74/lockfile
* github.com/mitchellh/panicwrap







